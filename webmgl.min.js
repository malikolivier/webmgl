"use strict";(function(){function a(a){return new Error("[WebMGL] "+a)}function b(a){var b=c(a),d=0;return g([{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:k(b.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:25541},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:b.width,id:176},{data:b.height,id:186}]}]}]},{id:524531317,data:[{data:0,id:231}].concat(a.map(function(a){var b=h({discardable:0,frame:a.data.slice(a.data.indexOf("*")-3),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(d)});return d+=a.duration,{data:b,id:163}}))}]}])}function c(b){for(var c=b[0].width,d=b[0].height,e=b[0].duration,f=1;f<b.length;f++){if(b[f].width!==c)throw a("Frame "+(f+1)+" has a different width");if(b[f].height!==d)throw a("Frame "+(f+1)+" has a different height");if(b[f].duration<0)throw a("Frame "+(f+1)+" has a weird duration");e+=b[f].duration}return{duration:e,width:c,height:d}}function d(a){for(var b=[];a>0;)b.push(255&a),a>>=8;return new Uint8Array(b.reverse())}function e(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}function f(a){var b=[];a=(a.length%8?new Array(9-a.length%8).join("0"):"")+a;for(var c=0;c<a.length;c+=8)b.push(parseInt(a.substr(c,8),2));return new Uint8Array(b)}function g(a){for(var b=[],c=0;c<a.length;c++){var h=a[c].data;"object"==typeof h&&(h=g(h)),"number"==typeof h&&(h=f(h.toString(2))),"string"==typeof h&&(h=e(h));var i=h.size||h.byteLength,j=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8),k=i.toString(2),l=new Array(7*j+7+1-k.length).join("0")+k,n=new Array(j).join("0")+"1"+l;b.push(d(a[c].id)),b.push(f(n)),b.push(h)}if(m.Blob)return new m.Blob(b,{type:"video/webm"});var o=Buffer.from(b);return Uint8Array.from(o).buffer}function h(b){var c=0;if(b.keyframe&&(c|=128),b.invisible&&(c|=8),b.lacing&&(c|=b.lacing<<1),b.discardable&&(c|=1),b.trackNum>127)throw a("TrackNumber > 127 not supported");return[128|b.trackNum,b.timecode>>8,255&b.timecode,c].map(function(a){return String.fromCharCode(a)}).join("")+b.frame}function i(a){for(var b=a.RIFF[0].WEBP[0],c=b.indexOf("*"),d=0,e=[];d<4;d++)e[d]=b.charCodeAt(c+3+d);var f,g,h;return h=e[1]<<8|e[0],f=16383&h,h=e[3]<<8|e[2],g=16383&h,{width:f,height:g,data:b,riff:a}}function j(a){for(var b=0,c={};b<a.length;){var d=a.substr(b,4),e=parseInt(a.substr(b+4,4).split("").map(function(a){var b=a.charCodeAt(0).toString(2);return new Array(8-b.length+1).join("0")+b}).join(""),2),f=a.substr(b+4+4,e);b+=8+e,c[d]=c[d]||[],"RIFF"===d||"LIST"===d?c[d].push(j(f)):c[d].push(f)}return c}function k(a){return[].slice.call(new Uint8Array(new Float64Array([a]).buffer),0).map(function(a){return String.fromCharCode(a)}).reverse().join("")}function l(a,b){this.frames=[],this.duration=1e3/a,this.quality=b||.8}var m=this,n={Video:l,fromImageArray:function(a,c){return b(a.map(function(a){var b=i(j(m.atob(a.slice(23))));return b.duration=1e3/c,b}))},toWebM:b};window&&window.atob?window.atob:require("atob");"undefined"!=typeof module&&module.exports?module.exports=n:m.WebMGL=n,l.prototype.add=function(b,c){if(void 0!==c&&this.duration)throw a("Cannot pass a duration if FPS is set");if(!/^data:image\/webp;base64,/gi.test(b))throw a("Input must be formatted properly as a base64 encoded DataURI of type image/webp");this.frames.push({image:b,duration:c||this.duration})},l.prototype.compile=function(){if(0===this.frames.length)throw a("You did not add any frame to the Video!");return b(this.frames.map(function(a){var b=i(j(m.atob(a.image.slice(23))));return b.duration=a.duration,b}))}}).call(this);